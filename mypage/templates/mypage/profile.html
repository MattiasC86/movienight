{% extends 'mypage/base.html' %}
{% block title %} {{ user.get_username }} Profile Page {% endblock %}

{% block body %}

    <div class="container">
        <div class="col-lg-12 mt-3">
            <h1 style="color:limegreen">{{ user.get_username }}</h1>
            <p class="text-muted">MovieNight member since {{ user.date_joined }}</p>
            <span class="text-white"><span style="color:deepskyblue">ACTIVE MOVIENIGHT EVENTS:</span> {{ movienights.count }}</span>
            <span class="text-muted ml-2 mr-2">-</span>
            <span class="text-white"><span style="color:deeppink">MOVIES IN BACKLOG:</span> {{ backlog.count }}</span>
            <span class="text-muted ml-2 mr-2">-</span>
            <span class="text-white"><span style="color:orange">LISTS CREATED:</span> 0</span>
            <hr class="bg-secondary">
        </div>


        <div class="col-lg-12">
            <button class="btn btn-light btn-sm" id="newPostBtn">+New post</button>
        </div>
        <div class="col-lg-6 mt-3" id="newPostDiv" style="display:none;">
            <input class="form-control" id="inputTitle" type="text" placeholder="Title">
            <textarea class="form-control mt-1" id="inputContent" cols="35" rows="7" name="" placeholder="Content" style="resize:none;overflow-x: hidden;"></textarea>
            <div class="text-right">
                <button class="btn btn-success btn mt-2" id="savePostBtn">Save post</button>
                <button class="btn btn-danger btn mt-2" id="cancelPostBtn">Cancel</button>
            </div>

        </div>

        <div class="row col-lg-12 mt-4">

            <div class="col-lg-5">
                <h5 class="lead text-dark bg-light p-1 pl-3"><strong>Posts</strong></h5>
                {% comment %}<div id="blogPosts">
                    <div class="mt-3 p-2 border border-secondary rounded" id="blogPost" style="display:none;background:#323232">
                        <div class="col-lg-l2">
                            <h5 class="text-light mb-0"><span id="postTitle">Some Title</span> <span><small class="text-dark rounded p-1" style="background:deepskyblue"><strong> <i class="fas fa-film fa-lg"></i> Review </strong></small></span></h5>
                            <p class="text-muted mt-0 mb-1">Posted by <span style="color:limegreen">admin</span> 2018-02-23 08:12</p>
                            <hr class="bg-secondary">
                        </div>
                        <div class="col-lg-l2">
                            <div class="text-light">
                                <p id="postContent" style="white-space: pre-wrap;"></p>
                            </div>
                        </div>
                        <div>
                            <a href="#">Comments</a>
                        </div>
                    </div>
                </div>{% endcomment %}
                <div id="blogPosts">
                    <div class="mt-3 p-2 bg-light border border-secondary rounded" id="blogPost" style="display:none">
                        <div class="col-lg-l2">
                            <h5 class="mb-0 text-dark"><span id="postTitle">Some Title</span></h5>
                            <p class="text-muted mt-0 mb-1">Posted by <span style="color:limegreen">admin</span> 2018-02-24 08:12</p>
                            <hr>
                        </div>
                        <div class="col-lg-l2">
                            <p id="postContent" style="white-space: pre-wrap;"></p>
                            <hr>
                        </div>
                        <div>
                            <a href="#">Comments</a>
                        </div>
                    </div>
                </div>
            </div>


        </div>


    </div>

    <script>
        $(function() {
            console.log("1");
            {% if blog_posts.count > 0 %}
                console.log("2");
                var blogPostDiv =   '<div class="mt-3" id="blogPost" style="display:none">' +
                                    '<div class="col-lg-l2">' +
                                    '<h5 class="text-light mb-0"><span id="postTitle">Some Title</span> <span><small class="text-dark rounded p-1" style="background:deepskyblue"><strong> <i class="fas fa-film fa-lg"></i> Review </strong></small></span></h5>' +
                                    '<p class="text-muted mt-0 mb-1">Posted by <span style="color:limegreen">admin</span> 2018-02-23 08:12</p>' +
                                    '</div>' +
                                    '<div class="col-lg-l2">' +
                                    '<div class="text-light">' +
                                    '<p id="postContent" style="white-space: pre-wrap;"></p>' +
                                    '</div>' +
                                    '</div>' +
                                    '<div>' +
                                    '<a href="#">Comments</a>' +
                                    '</div>' +
                                    '</div>';
                {% for b in blog_posts.all %}
                    console.log('{{ b.title }}');
                    $("#blogPosts").append(
                        '<div class="mt-3 p-2 rounded" id="blogPost" style="background:#323239;">' +
                            '<div class="col-lg-l2">' +
                                '<h5 class="text-light mb-0"><span id="postTitle"> {{ b.title }} </span></h5>' +
                                '<p class="text-muted mt-0 mb-1"><small>Posted by <span style="color:limegreen"> {{ b.user }} </span> {{ b.date }}</small></p>' +
                                '<hr class="bg-secondary">' +
                            '</div>' +
                            '<div class="col-lg-l2">' +
                                '<div class="text-light">' +
                                    '<p id="postContent" style="white-space: pre-wrap;">{{ b.content|linebreaksbr }}</p>' +
                                '</div>' +
                                '<hr class="bg-secondary">' +
                            '</div>' +
                            '<div>' +
                                '<a href="#">Comments (5)</a>' +
                            '</div>' +
                        '</div>'
                    );
                {% endfor %}
            {% endif %}



            $("#newPostBtn").click(function() {
                if(!$("#newPostDiv").is(':visible')) {
                    $("#newPostDiv").show(200);
                }
            });

            $("#savePostBtn").click(function() {
                var title = $("#inputTitle").val();
                var content = $("#inputContent").val();

                $.ajax({
                    url : '.',
                    type : 'POST',
                    data : { 'action': 'post_blog', 'title': title, 'content': content }

                }).done(function(response) {

                });

                $("#postTitle").text($("#inputTitle").val());
                $("#postContent").text($("#inputContent").val());
                closeNewMessageDiv();
                $("#blogPost").fadeIn(1000);

            });

            $("#cancelPostBtn").click(function() {
                closeNewMessageDiv()
            });

            function closeNewMessageDiv() {
                $("#newPostDiv").hide(200);
                $("#inputTitle").val("");
                $("#inputContent").val("");
            }

        });

    </script>

{% endblock %}